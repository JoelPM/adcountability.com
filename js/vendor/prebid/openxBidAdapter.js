"use strict";(self.pbjsChunk=self.pbjsChunk||[]).push([[534],{498:function(e,t,n){var r=n(265),a=n(853),i=n(806),o=n(962),d=n(125),s=n(3),c=n(879);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var m=[s.Mk,s.pX],l=["startdelay","mimes","minduration","maxduration","startdelay","skippable","playbackmethod","api","protocols","boxingallowed","linearity","delivery","protocol","placement","minbitrate","maxbitrate"],f={britepoolid:"britepoolid",criteoId:"criteoid",fabrickId:"nuestarid",haloId:"audigentid",id5id:"id5id",idl_env:"lre",IDP:"zeotapid",idxId:"idxid",intentIqId:"intentiqid",lipb:"lipbid",lotamePanoramaId:"lotameid",merkleId:"merkleid",netId:"netid",parrableId:"parrableid",pubcid:"pubcid",quantcastId:"quantcastid",tapadId:"tapadid",tdid:"ttduuid",uid2:"uid2",flocId:"floc",admixerId:"admixerid",deepintentId:"deepintentid",dmdId:"dmdid",nextrollId:"nextrollid",novatiq:"novatiqid",mwOpenLinkId:"mwopenlinkid",dapId:"dapid",amxId:"amxid",kpuid:"kpuid",publinkId:"publinkid",naveggId:"naveggid",imuid:"imuid",adtelligentId:"adtelligentid"},h={code:"openx",gvlid:69,supportedMediaTypes:m,isBidRequestValid:function(e){var t=e.params.delDomain||e.params.platform;return(0,r.Z)(e,"mediaTypes.banner")&&t?!!e.params.unit||(0,r.Z)(e,"mediaTypes.banner.sizes.length")>0:!(!e.params.unit||!t)},buildRequests:function(e,t){if(0===e.length)return[];var n,i,d=[],u=function(e){return e.reduce((function(e,t){var n;return n=t,(0,r.Z)(n,"mediaTypes.video")&&!(0,r.Z)(n,"mediaTypes.banner")||n.mediaType===s.pX?e[0].push(t):e[1].push(t),e}),[[],[]])}(e),m=(i=2,function(e){if(Array.isArray(e))return e}(n=u)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,d=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){d=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(d)throw a}}return i}}(n,i)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(n,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=m[0],h=m[1];return h.length>0&&d.push(function(e,t){var n=[],i=!1,d=b(e,t),c=(0,a._map)(e,(function(e){return e.params.unit}));return d.aus=(0,a._map)(e,(function(e){return(0,a.parseSizesInput)(e.mediaTypes.banner.sizes).join(",")})).join("|"),d.divids=(0,a._map)(e,(function(e){return encodeURIComponent(e.adUnitCode)})).join(","),d.aucs=(0,a._map)(e,(function(e){var t=(0,r.Z)(e,"ortb2Imp.ext.data.pbadslot");return encodeURIComponent(t||"")})).join(","),c.some((function(e){return e}))&&(d.auid=c.join(",")),e.some((function(e){return e.params.doNotTrack}))&&(d.ns=1),(!0===o.vc.getConfig("coppa")||e.some((function(e){return e.params.coppa})))&&(d.tfcd=1),e.forEach((function(e){if(e.params.customParams){var t=(0,a._map)(Object.keys(e.params.customParams),(function(t){return function(e,t){var n=t[e];return(0,a.isArray)(n)&&(n=n.join(",")),(e.toLowerCase()+"="+n.toLowerCase()).replace("+",".").replace("/","_")}(t,e.params.customParams)})),r=window.btoa(t.join("&"));i=!0,n.push(r)}else n.push("")})),i&&(d.tps=n.join(",")),g(d,s.Mk,e),{method:"GET",url:d.ph?"https://u.openx.net/w/1.0/arj":"https://".concat(e[0].params.delDomain,"/w/1.0/arj"),data:d,payload:{bids:e,startTime:new Date}}}(h,t)),f.length>0&&f.forEach((function(e){d.push(function(e,t){var n=function(e,t){var n,i,o=(0,r.Z)(e,"mediaTypes.video"),d=b([e],t),u=(0,r.Z)(e,"params.video")||{},p=(0,r.Z)(e,"mediaTypes.video.context"),m=(0,r.Z)(e,"mediaTypes.video.playerSize");(0,a.isArray)(e.sizes)&&2===e.sizes.length&&!(0,a.isArray)(e.sizes[0])?(n=parseInt(e.sizes[0],10),i=parseInt(e.sizes[1],10)):(0,a.isArray)(e.sizes)&&(0,a.isArray)(e.sizes[0])&&2===e.sizes[0].length?(n=parseInt(e.sizes[0][0],10),i=parseInt(e.sizes[0][1],10)):(0,a.isArray)(m)&&2===m.length&&(n=parseInt(m[0],10),i=parseInt(m[1],10));var f={w:n,h:i},h=e.params.video||e.params.openrtb||{};h.openrtb&&(h=h.openrtb),(0,a.isArray)(h.imp)&&(h=h.imp[0].video),Object.keys(h).filter((function(e){return(0,c.q9)(l,e)})).forEach((function(e){return f[e]=h[e]})),Object.keys(o).filter((function(e){return(0,c.q9)(l,e)})).forEach((function(e){return f[e]=o[e]}));var v={imp:[{video:f}]};d.openrtb=JSON.stringify(v),d.auid=e.params.unit,d.vwd=n||u.vwd,d.vht=i||u.vht,"outstream"===p&&(d.vos="101"),u.mimes&&(d.vmimes=u.mimes),e.params.test&&(d.vtest=1);var y=(0,r.Z)(e,"ortb2Imp.ext.data.pbadslot");return y&&(d.aucs=encodeURIComponent(y)),g(d,s.pX,[e]),d}(e,t);return{method:"GET",url:n.ph?"https://u.openx.net/v/1.0/avjp":"https://".concat(e.params.delDomain,"/v/1.0/avjp"),data:n,payload:{bid:e,startTime:new Date}}}(e,t))})),d},interpretResponse:function(e,t){var n=e.body,r=function(e){return/avjp$/.test(e.url)?s.pX:s.Mk}(t);return r===s.pX?function(e,t){var n=t.bid,r=(t.startTime,[]);if(void 0!==e&&""!==e.vastUrl&&e.pub_rev>0){var i=(0,a.parseUrl)(e.vastUrl).search||{},o={};o.requestId=n.bidId,e.deal_id&&(o.dealId=e.deal_id),o.ttl=300,o.netRevenue=!0,o.currency=e.currency,o.cpm=parseInt(e.pub_rev,10)/1e3,o.width=parseInt(e.width,10),o.height=parseInt(e.height,10),o.creativeId=e.adid,o.vastUrl=e.vastUrl,o.mediaType=s.pX,e.ph=i.ph,e.colo=i.colo,e.ts=i.ts,r.push(o)}return r}(n,t.payload):function(e,t){for(var n=t.bids,r=(t.startTime,e.ads.ad),a=[],i=0;i<r.length;i++){var o=r[i],d=parseInt(o.idx,10),s={};if(s.requestId=n[d].bidId,o.pub_rev){s.cpm=Number(o.pub_rev)/1e3;var c=o.creative[0];c&&(s.width=c.width,s.height=c.height),s.creativeId=c.id,s.ad=o.html,o.deal_id&&(s.dealId=o.deal_id),s.ttl=300,s.netRevenue=!0,s.currency=o.currency,o.tbd&&(s.tbd=o.tbd),s.ts=o.ts,s.meta={},o.brand_id&&(s.meta.brandId=o.brand_id),o.adomain&&length(o.adomain)>0?s.meta.advertiserDomains=o.adomain:s.meta.advertiserDomains=[],o.adv_id&&(s.meta.dspid=o.adv_id),a.push(s)}}return a}(n,t.payload)},getUserSyncs:function(e,t,n,a){if(e.iframeEnabled||e.pixelEnabled){var i=e.iframeEnabled?"iframe":"image",o=(0,r.Z)(t,"0.body.ads.pixels")||(0,r.Z)(t,"0.body.pixels")||function(e,t){var n=[];return e&&(n.push("gdpr="+(e.gdprApplies?1:0)),n.push("gdpr_consent="+encodeURIComponent(e.consentString||""))),t&&n.push("us_privacy="+encodeURIComponent(t)),"".concat("https://u.openx.net/w/1.0/pd").concat(n.length>0?"?"+n.join("&"):"")}(n,a);return[{type:i,url:o}]}},transformBidParams:function(e,t){return(0,a.convertTypes)({unit:"string",customFloor:"number"},e)}};function v(e){var t,n,r,a=window,i=document,o=i.documentElement;if(e){try{a=window.top,i=window.top.document}catch(e){return}o=i.documentElement,r=i.body,t=a.innerWidth||o.clientWidth||r.clientWidth,n=a.innerHeight||o.clientHeight||r.clientHeight}else o=i.documentElement,t=a.innerWidth||o.clientWidth,n=a.innerHeight||o.clientHeight;return"".concat(t,"x").concat(n)}function b(e,t){var n,d=(0,a.inIframe)();n={ju:o.vc.getConfig("pageUrl")||t.refererInfo.referer,ch:document.charSet||document.characterSet,res:"".concat(screen.width,"x").concat(screen.height,"x").concat(screen.colorDepth),ifr:d,tz:(new Date).getTimezoneOffset(),tws:v(d),be:1,bc:e[0].params.bc||"".concat("hb_pb","_").concat("3.0.3"),dddid:(0,a._map)(e,(function(e){return e.transactionId})).join(","),nocache:(new Date).getTime()};var s=y("ortb2.user.data");s.length>0&&(n.sm=s);var c,u,p,m,l,h=y("ortb2.site.content.data");if(h.length>0&&(n.scsm=h),e[0].params.platform&&(n.ph=e[0].params.platform),t.gdprConsent){var b=t.gdprConsent;void 0!==b.consentString&&(n.gdpr_consent=b.consentString),void 0!==b.gdprApplies&&(n.gdpr=b.gdprApplies?1:0),"iab"===o.vc.getConfig("consentManagement.cmpApi")&&(n.x_gdpr_f=1)}return t&&t.uspConsent&&(n.us_privacy=t.uspConsent),(0,r.Z)(e[0],"crumbs.pubcid")&&(0,i.Z)(e[0],"userId.pubcid",(0,r.Z)(e[0],"crumbs.pubcid")),c=n,u=e[0].userId,(0,a._each)(u,(function(e,t){var n=f[t];if(f.hasOwnProperty(t))switch(t){case"merkleId":case"flocId":case"uid2":c[n]=e.id;break;case"lipb":if(c[n]=e.lipbid,Array.isArray(e.segments)&&e.segments.length>0){var r="liveintent:"+e.segments.join("|");c.sm="".concat(c.sm?c.sm+",":"").concat(r)}break;case"parrableId":c[n]=e.eid;break;case"id5id":c[n]=e.uid;break;case"novatiq":c[n]=e.snowflake;break;default:c[n]=e}})),n=c,e[0].schain&&(n.schain=(p=e[0].schain,"".concat(p.ver,",").concat(p.complete,"!").concat((m=p.nodes,l=["asi","sid","hp","rid","name","domain"],m.map((function(e){return l.map((function(t){return e[t]||""})).join(",")})).join("!"))))),n}function y(e){var t=o.vc.getConfig(e);if(!Array.isArray(t)||!t.length)return"";var n=t.filter((function(e){return Array.isArray(e.segment)&&e.segment.length>0&&void 0!==e.name&&e.name.length>0})).reduce((function(e,t){var n="object"===u(t.ext)&&t.ext.segtax?"".concat(t.name,"/").concat(t.ext.segtax):t.name;return e[n]=(e[n]||[]).concat(t.segment.map((function(e){return e.id}))),e}),{});return Object.keys(n).map((function(e,t){return e+":"+n[e].join("|")})).join(",")}function g(e,t,n){var r=[],a=!1;n.forEach((function(e){var n=function(e,t){var n={},r=o.vc.getConfig("currency.adServerCurrency")||"USD";"function"==typeof e.getFloor&&(n=e.getFloor({currency:r,mediaType:t,size:"*"}));var a=n.floor||e.params.customFloor||0;return Math.round(1e3*a)}(e,t);n?(r.push(n),a=!0):r.push(0)})),a&&(e.aumfs=r.join(","))}(0,d.dX)(h),window.pbjs.installedModules.push("openxBidAdapter")}},function(e){e(e.s=498)}]);
//# sourceMappingURL=openxBidAdapter.js.map