{"version":3,"file":"openxRtbAdapter.js","mappings":"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","sources":["webpack://prebid.js/./modules/openxRtbAdapter.js"],"sourcesContent":["import {config} from '../src/config.js';\nimport {registerBidder} from '../src/adapters/bidderFactory.js';\nimport * as utils from '../src/utils.js';\nimport {BANNER, VIDEO} from '../src/mediaTypes.js';\nimport {includes} from '../src/polyfill.js';\n\nconst bidderConfig = 'hb_pb_ortb';\nconst bidderVersion = '1.0';\nconst VIDEO_TARGETING = ['startdelay', 'mimes', 'minduration', 'maxduration',\n  'startdelay', 'skippable', 'playbackmethod', 'api', 'protocols', 'boxingallowed',\n  'linearity', 'delivery', 'protocol', 'placement', 'minbitrate', 'maxbitrate', 'ext'];\nexport const REQUEST_URL = 'https://rtb.openx.net/openrtbb/prebidjs';\nexport const SYNC_URL = 'https://u.openx.net/w/1.0/pd';\nexport const DEFAULT_PH = '2d1251ae-7f3a-47cf-bd2a-2f288854a0ba';\nexport const spec = {\n  code: 'openx',\n  supportedMediaTypes: [BANNER, VIDEO],\n  isBidRequestValid,\n  buildRequests,\n  interpretResponse,\n  getUserSyncs,\n  transformBidParams\n};\n\nregisterBidder(spec);\n\nfunction transformBidParams(params, isOpenRtb) {\n  return utils.convertTypes({\n    'unit': 'string',\n    'customFloor': 'number'\n  }, params);\n}\n\nfunction isBidRequestValid(bidRequest) {\n  const hasDelDomainOrPlatform = bidRequest.params.delDomain ||\n    bidRequest.params.platform;\n\n  if (utils.deepAccess(bidRequest, 'mediaTypes.banner') &&\n    hasDelDomainOrPlatform) {\n    return !!bidRequest.params.unit ||\n      utils.deepAccess(bidRequest, 'mediaTypes.banner.sizes.length') > 0;\n  }\n\n  return !!(bidRequest.params.unit && hasDelDomainOrPlatform);\n}\n\nfunction buildRequests(bids, bidderRequest) {\n  let videoBids = bids.filter(bid => isVideoBid(bid));\n  let bannerBids = bids.filter(bid => isBannerBid(bid));\n  let requests = bannerBids.length ? [createBannerRequest(bannerBids, bidderRequest)] : [];\n  videoBids.forEach(bid => {\n    requests.push(createVideoRequest(bid, bidderRequest));\n  });\n  return requests;\n}\n\nfunction createBannerRequest(bids, bidderRequest) {\n  let data = getBaseRequest(bids[0], bidderRequest);\n  data.imp = bids.map(bid => {\n    const floor = getFloor(bid, BANNER);\n    let imp = {\n      id: bid.bidId,\n      tagid: bid.params.unit,\n      banner: {\n        format: toFormat(bid.mediaTypes.banner.sizes),\n        topframe: utils.inIframe() ? 0 : 1\n      },\n      ext: {divid: bid.adUnitCode}\n    };\n    enrichImp(imp, bid, floor);\n    return imp;\n  });\n\n  // TODO(joelpm): Probably a better way\n  let qsParams = new URLSearchParams(document.location.search);\n  let traceOwner = qsParams.get(\"to\");\n  let traceID = qsParams.get(\"ti\");\n  if (traceOwner != \"\" && traceID != \"\") {\n    utils.deepSetValue(data, 'ext.trace_owner', traceOwner);\n    utils.deepSetValue(data, 'ext.trace_id', traceID);\n  }\n\n  return {\n    method: 'POST',\n    url: REQUEST_URL,\n    data: data\n  }\n}\n\nfunction toFormat(sizes) {\n  return sizes.map((s) => {\n    return { w: s[0], h: s[1] };\n  });\n}\n\nfunction enrichImp(imp, bid, floor) {\n  if (bid.params.customParams) {\n    utils.deepSetValue(imp, 'ext.customParams', bid.params.customParams);\n  }\n  if (floor > 0) {\n    imp.bidfloor = floor;\n    imp.bidfloorcur = 'USD';\n  } else if (bid.params.customFloor) {\n    imp.bidfloor = bid.params.customFloor;\n  }\n  if (bid.ortb2Imp && bid.ortb2Imp.ext && bid.ortb2Imp.ext.data) {\n    imp.ext.data = bid.ortb2Imp.ext.data;\n  }\n}\n\nfunction enrichFloc(req, bid) {\n  if (bid.userId && bid.userId.flocId) {\n    const flocObject = {\n      id: 'chrome',\n      segment: [{\n        id: 'floc',\n        value: bid.userId.flocId.id.toString(),\n        ext: {\n          ver: bid.userId.flocId.version\n        }\n      }]\n    }\n    if (!req.user) {\n      req.user = {};\n    }\n    if (!req.user.data) {\n      req.user.data = [];\n    }\n    req.user.data.push(flocObject);\n  }\n}\n\nfunction createVideoRequest(bid, bidderRequest) {\n  let width;\n  let height;\n  const videoMediaType = utils.deepAccess(bid, `mediaTypes.video`);\n  const playerSize = utils.deepAccess(bid, 'mediaTypes.video.playerSize');\n  const context = utils.deepAccess(bid, 'mediaTypes.video.context');\n  const floor = getFloor(bid, VIDEO);\n\n  // normalize config for video size\n  if (utils.isArray(bid.sizes) && bid.sizes.length === 2 && !utils.isArray(bid.sizes[0])) {\n    width = parseInt(bid.sizes[0], 10);\n    height = parseInt(bid.sizes[1], 10);\n  } else if (utils.isArray(bid.sizes) && utils.isArray(bid.sizes[0]) && bid.sizes[0].length === 2) {\n    width = parseInt(bid.sizes[0][0], 10);\n    height = parseInt(bid.sizes[0][1], 10);\n  } else if (utils.isArray(playerSize) && playerSize.length === 2) {\n    width = parseInt(playerSize[0], 10);\n    height = parseInt(playerSize[1], 10);\n  }\n\n  let data = getBaseRequest(bid, bidderRequest);\n  data.imp = [{\n    id: bid.bidId,\n    tagid: bid.params.unit,\n    video: {\n      w: width,\n      h: height,\n      topframe: utils.inIframe() ? 0 : 1\n    },\n    ext: {divid: bid.adUnitCode}\n  }];\n\n  enrichImp(data.imp[0], bid, floor);\n\n  if (context) {\n    if (context === 'instream') {\n      data.imp[0].video.placement = 1;\n    } else if (context === 'outstream') {\n      data.imp[0].video.placement = 4;\n    }\n  }\n\n  let videoParams = bid.params.video || bid.params.openrtb || {};\n  if (utils.isArray(videoParams.imp)) {\n    videoParams = videoParams[0].video;\n  }\n\n  Object.keys(videoParams)\n    .filter(param => includes(VIDEO_TARGETING, param))\n    .forEach(param => data.imp[0].video[param] = videoParams[param]);\n  Object.keys(videoMediaType)\n    .filter(param => includes(VIDEO_TARGETING, param))\n    .forEach(param => data.imp[0].video[param] = videoMediaType[param]);\n\n  return {\n    method: 'POST',\n    url: REQUEST_URL,\n    data: data\n  }\n}\n\nfunction getBaseRequest(bid, bidderRequest) {\n  let req = {\n    id: bidderRequest.auctionId,\n    cur: [config.getConfig('currency.adServerCurrency') || 'USD'],\n    at: 1,\n    tmax: config.getConfig('bidderTimeout'),\n    site: {\n      page: config.getConfig('pageUrl') || bidderRequest.refererInfo.referer\n    },\n    regs: {\n      coppa: (config.getConfig('coppa') === true || bid.params.coppa) ? 1 : 0,\n    },\n    device: {\n      dnt: (utils.getDNT() || bid.params.doNotTrack) ? 1 : 0,\n      h: screen.height,\n      w: screen.width,\n      ua: window.navigator.userAgent,\n      language: window.navigator.language.split('-').shift()\n    },\n    ext: {\n      bc: bid.params.bc || `${bidderConfig}_${bidderVersion}`\n    }\n  };\n\n  if (bid.params.platform) {\n    utils.deepSetValue(req, 'ext.platform', bid.params.platform);\n  }\n  if (bid.params.delDomain) {\n    utils.deepSetValue(req, 'ext.delDomain', bid.params.delDomain);\n  }\n  if (bid.params.test) {\n    req.test = 1\n  }\n  if (bidderRequest.gdprConsent) {\n    if (bidderRequest.gdprConsent.gdprApplies !== undefined) {\n      utils.deepSetValue(req, 'regs.ext.gdpr', bidderRequest.gdprConsent.gdprApplies === true ? 1 : 0);\n    }\n    if (bidderRequest.gdprConsent.consentString !== undefined) {\n      utils.deepSetValue(req, 'user.ext.consent', bidderRequest.gdprConsent.consentString);\n    }\n    if (bidderRequest.gdprConsent.addtlConsent !== undefined) {\n      utils.deepSetValue(req, 'user.ext.ConsentedProvidersSettings.consented_providers', bidderRequest.gdprConsent.addtlConsent);\n    }\n  }\n  if (bidderRequest.uspConsent) {\n    utils.deepSetValue(req, 'regs.ext.us_privacy', bidderRequest.uspConsent);\n  }\n  if (bid.schain) {\n    utils.deepSetValue(req, 'source.ext.schain', bid.schain);\n  }\n  if (bid.userIdAsEids) {\n    utils.deepSetValue(req, 'user.ext.eids', bid.userIdAsEids);\n  }\n  const commonFpd = config.getConfig('ortb2') || {};\n  if (commonFpd.site) {\n    utils.mergeDeep(req, {site: commonFpd.site});\n  }\n  if (commonFpd.user) {\n    utils.mergeDeep(req, {user: commonFpd.user});\n  }\n  enrichFloc(req, bid)\n  return req;\n}\n\nfunction isVideoBid(bid) {\n  return utils.deepAccess(bid, 'mediaTypes.video');\n}\n\nfunction isBannerBid(bid) {\n  return utils.deepAccess(bid, 'mediaTypes.banner') || !isVideoBid(bid);\n}\n\nfunction getFloor(bid, mediaType) {\n  let floor = 0;\n\n  if (typeof bid.getFloor === 'function') {\n    const floorInfo = bid.getFloor({\n      currency: 'USD',\n      mediaType: mediaType,\n      size: '*'\n    });\n\n    if (typeof floorInfo === 'object' &&\n      floorInfo.currency === 'USD' &&\n      !isNaN(parseFloat(floorInfo.floor))) {\n      floor = Math.max(floor, parseFloat(floorInfo.floor));\n    }\n  }\n\n  return floor;\n}\n\nfunction interpretResponse(resp, req) {\n  // pass these from request to the responses for use in userSync\n  if (req.data.ext) {\n    if (req.data.ext.delDomain) {\n      utils.deepSetValue(resp, 'body.ext.delDomain', req.data.ext.delDomain);\n    }\n    if (req.data.ext.platform) {\n      utils.deepSetValue(resp, 'body.ext.platform', req.data.ext.platform);\n    }\n  }\n\n  const respBody = resp.body;\n  if ('nbr' in respBody) {\n    return [];\n  }\n\n  let bids = [];\n  respBody.seatbid.forEach(seatbid => {\n    bids = [...bids, ...seatbid.bid.map(bid => {\n      let response = {\n        requestId: bid.impid,\n        cpm: bid.price,\n        width: bid.w,\n        height: bid.h,\n        creativeId: bid.crid,\n        dealId: bid.dealid,\n        currency: respBody.cur || 'USD',\n        netRevenue: true,\n        ttl: 300,\n        mediaType: 'banner' in req.data.imp[0] ? BANNER : VIDEO,\n        meta: { advertiserDomains: bid.adomain }\n      };\n\n      if (response.mediaType === VIDEO) {\n        if (bid.nurl) {\n          response.vastUrl = bid.nurl;\n        } else {\n          response.vastXml = bid.adm;\n        }\n      } else {\n        response.ad = bid.adm;\n      }\n\n      if (bid.ext) {\n        response.meta.networkId = bid.ext.dsp_id;\n        response.meta.advertiserId = bid.ext.buyer_id;\n        response.meta.brandId = bid.ext.brand_id;\n      }\n      return response\n    })];\n  });\n\n  return bids;\n}\n\n/**\n * @param syncOptions\n * @param responses\n * @param gdprConsent\n * @param uspConsent\n * @return {{type: (string), url: (*|string)}[]}\n */\nfunction getUserSyncs(syncOptions, responses, gdprConsent, uspConsent) {\n  if (syncOptions.iframeEnabled || syncOptions.pixelEnabled) {\n    let pixelType = syncOptions.iframeEnabled ? 'iframe' : 'image';\n    let queryParamStrings = [];\n    let syncUrl = SYNC_URL;\n    if (gdprConsent) {\n      queryParamStrings.push('gdpr=' + (gdprConsent.gdprApplies ? 1 : 0));\n      queryParamStrings.push('gdpr_consent=' + encodeURIComponent(gdprConsent.consentString || ''));\n    }\n    if (uspConsent) {\n      queryParamStrings.push('us_privacy=' + encodeURIComponent(uspConsent));\n    }\n    if (responses.length > 0 && responses[0].body && responses[0].body.ext) {\n      const ext = responses[0].body.ext;\n      if (ext.delDomain) {\n        syncUrl = `https://${ext.delDomain}/w/1.0/pd`\n      } else if (ext.platform) {\n        queryParamStrings.push('ph=' + ext.platform)\n      }\n    } else {\n      queryParamStrings.push('ph=' + DEFAULT_PH)\n    }\n    return [{\n      type: pixelType,\n      url: `${syncUrl}${queryParamStrings.length > 0 ? '?' + queryParamStrings.join('&') : ''}`\n    }];\n  }\n}\n"],"names":["VIDEO_TARGETING","REQUEST_URL","spec","code","supportedMediaTypes","BANNER","VIDEO","isBidRequestValid","bidRequest","hasDelDomainOrPlatform","params","delDomain","platform","utils","unit","buildRequests","bids","bidderRequest","videoBids","filter","bid","isVideoBid","bannerBids","isBannerBid","requests","length","createBannerRequest","forEach","push","width","height","videoMediaType","playerSize","context","floor","getFloor","sizes","parseInt","data","getBaseRequest","imp","id","bidId","tagid","video","w","h","topframe","ext","divid","adUnitCode","enrichImp","placement","videoParams","openrtb","Object","keys","param","includes","method","url","createVideoRequest","interpretResponse","resp","req","respBody","body","seatbid","map","response","requestId","impid","cpm","price","creativeId","crid","dealId","dealid","currency","cur","netRevenue","ttl","mediaType","meta","advertiserDomains","adomain","nurl","vastUrl","vastXml","adm","ad","networkId","dsp_id","advertiserId","buyer_id","brandId","brand_id","getUserSyncs","syncOptions","responses","gdprConsent","uspConsent","iframeEnabled","pixelEnabled","pixelType","queryParamStrings","syncUrl","gdprApplies","encodeURIComponent","consentString","type","join","transformBidParams","isOpenRtb","banner","format","mediaTypes","s","qsParams","URLSearchParams","document","location","search","traceOwner","get","traceID","customParams","bidfloor","bidfloorcur","customFloor","ortb2Imp","auctionId","config","at","tmax","site","page","refererInfo","referer","regs","coppa","device","dnt","doNotTrack","screen","ua","window","navigator","userAgent","language","split","shift","bc","test","undefined","addtlConsent","schain","userIdAsEids","commonFpd","user","userId","flocId","flocObject","segment","value","toString","ver","version","enrichFloc","floorInfo","size","isNaN","parseFloat","Math","max","registerBidder","pbjs","installedModules"],"sourceRoot":""}